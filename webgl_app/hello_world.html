<!DOCTYPE html>
<html>
<head lang="en">
    <meta charset="UTF-8">
    <title></title>
    <style>
        body {
            margin: 0;
        }
    </style>
</head>
<body>

</body>
</html>
<script src="lib/three.min.js"></script>
<script>

    var scene, sceneRTT, camera, renderer;
    var geometry, material, mesh, plane1, plane2;
    var texture, rtTexture;
    
    var canvas = document.createElement('canvas');
    canvas.width = 64;
    canvas.height = 64;
    canvas.style.position = 'absolute';
    canvas.style.left = 0;
    canvas.top = 0;
    
    var ctx = canvas.getContext('2d');
    ctx.clearRect(0,0,64,64);
    ctx.fillStyle = 'rgba(255,255,255,1.0)';
    ctx.beginPath();
    ctx.arc(32,32,30,0,2*Math.PI,false);
    ctx.fill();
    
    init();
//    animate();
    
    function randomColor() {
        var rand = Math.random;
        return new THREE.Color(rand(), rand(), rand());
    }

    function init() {

        scene = new THREE.Scene();
        sceneRTT = new THREE.Scene();

        camera = new THREE.OrthographicCamera(0, window.innerWidth, window.innerHeight, 0, 0, 500);
        camera.position.z = 200;

        texture = new THREE.Texture(canvas);
        texture.needsUpdate = true;

        rtTexture = new THREE.WebGLRenderTarget(
                window.innerWidth, window.innerHeight,
                {
                    minFilter: THREE.LinearFilter,
                    magFilter: THREE.NearestFilter,
                    format: THREE.RGBFormat
                }
        );

        plane1 = new THREE.Mesh(
                new THREE.PlaneGeometry(64, 64, 1, 1),
                new THREE.MeshBasicMaterial({
                    map: texture, 
                    transparent: true, 
                    color:randomColor()
                })
        );

        plane1.position.x = 100;
        plane1.position.y = 100;
        plane1.position.z = 1;

        plane2 = new THREE.Mesh(
                new THREE.PlaneGeometry(64, 64, 1, 1),
                new THREE.MeshBasicMaterial({color: 0xff00ff})
        );

        plane2.position.x = 120;
        plane2.position.y = 120;

        sceneRTT.add(plane2);
        sceneRTT.add(plane1);

        renderer = new THREE.WebGLRenderer({
            antialias: true,
            preserveDrawingBuffer: true
        });
        renderer.setSize(window.innerWidth, window.innerHeight);
        renderer.autoClear = false;

        document.body.appendChild(renderer.domElement);

        renderer.render(sceneRTT, camera, rtTexture, false);

        var rtPlane = new THREE.Mesh(
                 new THREE.PlaneGeometry(window.innerWidth, window.innerHeight, 1, 1),
                 new THREE.MeshBasicMaterial({
                     map: rtTexture
                 })
        );

        rtPlane.position.x = window.innerWidth / 2;
        rtPlane.position.y = window.innerHeight / 2;
        scene.add(rtPlane);
        
        renderer.render(scene, camera);
    }
    
    var down = false;
    
    document.addEventListener('mousedown', function(e) {
        plane1.position.x = e.pageX;
        plane1.position.y = window.innerHeight - e.pageY;

        plane1.material.color = randomColor();

        renderer.render(sceneRTT, camera, rtTexture, false);
        renderer.render( scene, camera );
        down = true;
    });
    
    document.addEventListener('mousemove', function(e) {
        if (down) {
            plane1.position.x = e.pageX;
            plane1.position.y = window.innerHeight - e.pageY;

            renderer.render(sceneRTT, camera, rtTexture, false);
            renderer.render( scene, camera );
        }
    });
    
    document.addEventListener('mouseup', function(e) {
        if (down) {
            down = false;
        }
    });

//    function animate() {
//        requestAnimationFrame( animate );
//
//        renderer.render( scene, camera );
//    }
    
</script>